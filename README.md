# Content Extractor with Vision LLM

This repository contains a Python project that extracts text and images from various file types (PDF, DOCX, PPTX), describes the images using the `llama3.2-vision` model, and saves the results in a specified output directory.

## TODO
- Implement two interfaces for DOCX extraction:
  - Interface 1: Current method (extract text and images separately)
  - Interface 2: Page-as-image method (capture each page as an image)
- Add configuration option in config.py to select DOCX extraction method
- Change PDF extractor to write output in markdown format
- Implement extraction from XLSX in a meaningful way

## Features

- Extract text and images from PDF, DOCX, and PPTX files
- Describe images using the `llama3.2-vision` model
- Save extracted text and image descriptions in a specified output directory
- User-friendly command-line interface for specifying input and output folders
- Modular and extensible code structure following SOLID principles
- Compare image descriptions generated by different models

## Prerequisites

- Python 3.x
- Poetry
- Ollama
- LibreOffice (required for PPTX processing)

## Installation

1. **Clone the Repository**

   ```bash
   git clone https://github.com/yourusername/file-extractor.git
   cd file-extractor
   ```

2. **Install Poetry**

   If you haven't installed Poetry yet, you can do so by following the instructions on the [Poetry website](https://python-poetry.org/docs/#installation).

3. **Install System Dependencies**

   LibreOffice and poppler are required for DOCX and PDF processing:

   - macOS (using Homebrew):
     ```bash
     brew install --cask libreoffice
     brew install poppler
     ```

   - Ubuntu/Debian:
     ```bash
     sudo apt-get update
     sudo apt-get install libreoffice
     sudo apt-get install poppler-utils
     ```

   - Windows:
     - Download and install [LibreOffice](https://www.libreoffice.org/download/download/)
     - Download and install [poppler](http://blog.alivate.com.au/poppler-windows/)
     - Add the poppler `bin` directory to your system PATH

4. **Install Project Dependencies**

   Use Poetry to install the project dependencies:

   ```bash
   poetry install
   ```

   This will install all required Python packages, including:
   - python-docx
   - pdf2image
   - python-pptx
   - Pillow
   - And other dependencies specified in pyproject.toml

## Setup Ollama

1. **Run Ollama Server**

   Start the Ollama server by running:

   ```bash
   ollama serve
   ```

2. **Pull the `llama3.2-vision` Model**

   Pull the required model by executing:

   ```bash
   ollama pull llama3.2-vision
   ```

## Configuration

The image description script can be configured using the `config.py` file. The available configuration options are:

- `DEFAULT_IMAGE_PATH`: The default path to the image file to be described.
- `DEFAULT_DESCRIBER`: The default describer to use for generating image descriptions. Available options are "openai" (OpenAI API) and "ollama" (local Ollama model).
- `DEFAULT_MODEL`: The default model to use for image description. The available options depend on the selected describer:
  - OpenAI describer: "gpt-4o" (default), "gpt-3.5-turbo"
  - Ollama describer: "llava", "llava:34b", "llama3.2-vision"

You can modify these configuration options in the `config.py` file to customize the script's behavior according to your requirements.

## Usage

1. **Run the Main Script**

   Execute the main script using Poetry:

   ```bash
   poetry run python main.py
   ```

2. **Provide Input**

   When prompted, enter the following information:
   - Source folder path (default: `./content/source`)
   - Output folder path (default: `./content/extracted`)
   - File type to process (pdf, docx, or pptx)

   The script will process the specified file type from the source folder and save the extracted text and image descriptions in the output folder.

### Command-line Arguments

- `--source` or `-s`: Specifies the path to the source folder containing the files to process. Default: `./content/source`.
- `--output` or `-o`: Specifies the path to the output directory where the extracted content will be saved. Default: `./content/extracted`.
- `--type` or `-t`: Specifies the type of files to process. Accepted values: "pdf", "docx", "pptx".

### Examples

1. Process all DOCX files in the default source folder and save the output to the default output directory:
   ```bash
   poetry run python main.py --type docx
   ```

2. Process all PDF files in a specific source folder and save the output to a specific directory:
   ```bash
   poetry run python main.py --source /path/to/source/folder --output /path/to/output/directory --type pdf
   ```

3. Process all PPTX files in the default source folder and save the output to a specific directory:
   ```bash
   poetry run python main.py --output /path/to/output/directory --type pptx
   ```

### Behavior

- If the `--source` argument is not provided, the script will use the default value of `./content/source` for the source folder.
- If the `--output` argument is not provided, the script will use the default value of `./content/extracted` for the output directory.
- If the `--type` argument is not provided, the script will prompt the user to enter the file type interactively.

## Dependencies

All Python dependencies are managed through Poetry and specified in `pyproject.toml`. The main dependencies include:

- PyMuPDF
- python-docx
- python-pptx
- Pillow
- pdf2image

System dependencies required:
- LibreOffice (for DOCX/PPTX processing)
- poppler (for PDF to image conversion)

Poetry will handle installing all Python packages and their correct versions. System dependencies need to be installed separately using your system's package manager.

## License

This project is licensed under the [MIT License](LICENSE).

### Configuration

The script's behavior can be customized through the `config.py` file:

```python
# The default path to the image file to be described
DEFAULT_IMAGE_PATH = "./test_image.jpg"

# The default describer to use (openai or ollama)
DEFAULT_DESCRIBER = "openai"

# The default model to use for image description
DEFAULT_MODEL = "gpt-3.5-turbo"

# The DOCX extraction method to use
DEFAULT_DOCX_EXTRACTOR = "page_as_image"
```

#### Available Configuration Options:

1. **Image Description Models**:
   - OpenAI Models:
     - `gpt-4o`: GPT-4 optimized for image description
     - `gpt-3.5-turbo`: GPT-3.5 Turbo model
   - Ollama Models:
     - `llava`: Standard llava model
     - `llava:34b`: Larger llava model
     - `llama3.2-vision`: Llama vision model

2. **DOCX Extraction Methods**:
   - `text_and_images`: Extracts text and images separately
     - Preserves original text formatting
     - Extracts embedded images individually
     - Best for documents where text content needs to be preserved exactly
   - `page_as_image`: Converts each page to an image
     - Captures the exact visual appearance of each page
     - Includes layout, formatting, and visual elements
     - Best for documents where visual layout is important
     - Requires LibreOffice for PDF conversion

#### Dependencies:
- For `page_as_image` extraction:
  - LibreOffice (for DOCX to PDF conversion)
  - poppler (for PDF to image conversion)
  - pdf2image Python package
